//
//  WFBezierCombinatoricsTests.m
//  WFBezierCombinatoricsTests
//
//  Created by Noah Desch on 3/6/14.
//  Copyright (c) 2014 Noah Desch.
//

#import <XCTest/XCTest.h>
#import "WFGeometry.h"
#import "NSBezierPath+WFBezierCombinatorics.h"

@interface WFBezierCombinatoricsTests : XCTestCase

@end

@implementation WFBezierCombinatoricsTests

- (void)setUp
{
    [super setUp];
    // Put setup code here. This method is called before the invocation of each test method in the class.
}

- (void)tearDown
{
    // Put teardown code here. This method is called after the invocation of each test method in the class.
    [super tearDown];
}

#define WFBezierPointAcceptanceResolution (1.0E-6)

- (void)testBezierPathBasicUnion
{
	NSBezierPath * a = [[NSBezierPath alloc] init];
	NSBezierPath * b = [[NSBezierPath alloc] init];
	NSBezierPath * result = nil;
	CGPoint points[3];
	NSBezierPathElement element;
	
	// Single path intersection in top-right corner
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(56.0, 52.0, 100.0, 100.0)];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 52.359143)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(114.713969, 50.590803)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(130.063321, 55.352643)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(141.355339, 66.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(160.881554, 86.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(160.881554, 117.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(141.355339, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(121.829124, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(90.170876, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(70.644661, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.372795, 127.083473)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(55.504497, 113.454260)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(56.039767, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Single path intersection in bottom left corner
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-56.0, -53.0, 100.0, 100.0)];
	result = [b WFUnionWithPath:a];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(29.355339, -38.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(39.881789, -27.828889)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(44.733501, -13.776608)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(43.910475, -0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 46.640857)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-14.713969, 48.409197)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-30.063321, 43.647357)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-41.355339, 32.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-60.881554, 12.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-60.881554, -18.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-41.355339, -38.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-21.829124, -57.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(9.829124, -57.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(29.355339, -38.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Dual path intersect
	[a appendBezierPath:[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(250.0, 250.0, 100.0, 100.0)]];
	[b appendBezierPath:[NSBezierPath bezierPathWithRect:NSMakeRect(200.0, 100.0, 100.0, 200.0)]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 46.640857)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-14.713969, 48.409197)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-30.063321, 43.647357)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-41.355339, 32.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-60.881554, 12.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-60.881554, -18.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-41.355339, -38.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-21.829124, -57.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(9.829124, -57.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(29.355339, -38.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(39.881789, -27.828889)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(44.733501, -13.776608)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(43.910475, -0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(335.355339, 264.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(354.881554, 284.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(354.881554, 315.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(335.355339, 335.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(315.829124, 354.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(284.170876, 354.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(264.644661, 335.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(254.881554, 325.592232)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(250.000000, 312.796116)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(250.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 300.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.0, 250.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Tripple intersect
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(52.0, 62.0, 200.0, 100.0)];
	[a appendBezierPath:[NSBezierPath bezierPathWithRect:NSMakeRect(200.0, 100.0, 100.0, 200.0)]];
	[b appendBezierPath:[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(250.0, 250.0, 100.0, 100.0)]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 69.278146)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(138.494006, 57.543350)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(189.419065, 59.998854)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(222.710678, 76.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(236.084849, 83.331746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(244.878806, 91.441721)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(249.092551, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.0, 250.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(312.796116, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(325.592232, 254.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(335.355339, 264.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(354.881554, 284.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(354.881554, 315.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(335.355339, 335.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(315.829124, 354.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(284.170876, 354.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(264.644661, 335.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(254.881554, 325.592232)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(250.000000, 312.796116)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(250.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 300.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 155.878269)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(162.036434, 166.271692)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(113.440076, 163.430716)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(81.289322, 147.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(55.611063, 134.516210)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(46.817105, 116.431800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(54.907449, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Single Paths with holes
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(20.0, 20.0, 60.0, 60.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(32.0, 32.0, 100.0, 100.0)];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(52.0, 52.0, 60.0, 60.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 29, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 35.338988)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(106.324722, 37.774820)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(112.254055, 41.543377)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(117.355339, 46.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(136.881554, 66.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(136.881554, 97.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(117.355339, 117.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(97.829124, 136.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(66.170876, 136.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(46.644661, 117.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(41.543377, 112.254055)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(37.774820, 106.324722)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(35.338988, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(57.995249, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(58.837105, 101.119765)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(59.767620, 102.194027)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(60.786797, 103.213203)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(72.502525, 114.928932)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(91.497475, 114.928932)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(103.213203, 103.213203)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(114.928932, 91.497475)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(114.928932, 72.502525)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(103.213203, 60.786797)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(102.194027, 59.767620)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(101.119765, 58.837105)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 57.995249)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(32.039767, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(32.522014, 67.878501)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(37.390312, 55.899010)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(46.644661, 46.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(55.899010, 37.390312)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(67.878501, 32.522014)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 32.039767)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:24 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 52.066330)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:25 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(73.001939, 52.531063)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(66.135708, 55.437885)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(60.786797, 60.786797)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:26 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(55.437885, 66.135708)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(52.531063, 73.001939)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(52.066330, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:27 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:28 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Both paths curved
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(56.0, 52.0, 100.0, 100.0)];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.720325, 25.009647)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(100.583326, 38.793127)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(99.944343, 52.365864)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(114.675254, 50.578805)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(130.049082, 55.338404)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(141.355339, 66.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(160.881554, 86.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(160.881554, 117.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(141.355339, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(121.829124, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(90.170876, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(70.644661, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.279675, 126.990353)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(55.416674, 113.206873)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(56.055657, 99.634136)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(41.324746, 101.421195)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(25.950918, 96.661596)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-4.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-4.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(34.170876, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(65.829124, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Both paths curved intersected the other way
	result = [b WFUnionWithPath:a];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(141.355339, 66.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(160.881554, 86.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(160.881554, 117.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(141.355339, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(121.829124, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(90.170876, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(70.644661, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.279675, 126.990353)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(55.416674, 113.206873)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(56.055657, 99.634136)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake( 41.324746, 101.421195)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(25.950918, 96.661596)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-4.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-4.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(34.170876, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(65.829124, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.720325, 25.009647)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(100.583326, 38.793127)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(99.944343, 52.365864)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(114.675254, 50.578805)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(130.049082, 55.338404)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(141.355339, 66.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// 2 curved paths with curved holes, union has 2 holes
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-52.0, -62.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-42.0, -52.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 23, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(104.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(104.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(65.829124, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(34.170876, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(1.774073, 72.484751)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-2.612944, 54.343147)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(1.483611, 37.879245)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-12.447185, 38.846294)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-26.705686, 34.004993)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-37.355339, 23.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-56.881554, 3.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-56.881554, -27.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-37.355339, -47.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-17.829124, -66.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(13.829124, -66.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(33.355339, -47.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(46.225927, -34.484751)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(50.612944, -16.343147)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(46.516389, 0.120755)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.447185, -0.846294)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(74.705686, 3.995007)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.655743, 8.633579)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(27.816573, 4.472989)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(35.419259, 2.162891)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.805526, -12.093238)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(37.760530, -28.808012)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(26.284271, -40.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.663300, -55.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-14.663300, -55.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-30.284271, -40.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-45.905243, -24.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-45.905243, 0.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-30.284271, 16.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-20.575065, 25.993478)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-7.116343, 29.667932)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(5.430875, 27.307634)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(7.755722, 22.743778)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(10.826984, 18.462338)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(78.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(68.575065, 12.006522)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(55.116343, 8.332068)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(42.569125, 10.692366)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.244278, 15.256222)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(37.173016, 19.537662)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(33.355339, 23.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(27.344257, 29.366421)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(20.183427, 33.527011)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(12.580741, 35.837109)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(7.194474, 50.093238)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(10.239470, 66.808012)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(37.336700, 93.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(62.663300, 93.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(93.905243, 62.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(93.905243, 37.336700)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// 2 curved paths with curved holes, union has 3 holes
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-42.0, -52.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-32.0, -42.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 28, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(104.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(104.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(65.829124, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(34.170876, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(4.212587, 74.923266)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-0.646048, 61.028301)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.068756, 47.370613)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-9.971277, 45.766220)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-19.616216, 41.094462)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-27.355339, 33.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-46.881554, 13.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-46.881554, -17.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-27.355339, -37.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-7.829124, -56.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(23.829124, -56.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(43.355339, -37.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(53.787413, -26.923266)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(58.646048, -13.028301)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(57.931244, 0.629387)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(67.971277, 2.233780)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(77.616216, 6.905538)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(23.885820, 5.403502)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(35.844360, 0.535900)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(47.948174, 0.041856)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(48.502201, -10.864446)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(44.614233, -21.954309)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(36.284271, -30.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.663300, -45.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-4.663300, -45.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-20.284271, -30.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-35.905243, -14.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-35.905243, 10.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-20.284271, 26.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-14.111369, 32.457173)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-6.422861, 36.190745)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(1.583416, 37.484985)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(3.738108, 29.116589)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(8.091856, 21.197466)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(78.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(72.111369, 15.542827)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(64.422861, 11.809255)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(56.416584, 10.515015)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(54.261892, 18.883411)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(49.908144, 26.802534)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(43.355339, 33.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(34.114180, 42.596498)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(22.155640, 47.464100)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.051826, 47.958144)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(9.497799, 58.864446)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(13.385767, 69.954309)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(37.336700, 93.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(62.663300, 93.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(93.905243, 62.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(93.905243, 37.336700)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(21.715729, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:24 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(17.045252, 26.386206)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(13.771190, 31.924304)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(11.893542, 37.811207)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:25 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.796796, 36.945582)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(29.465272, 33.103271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(36.284271, 26.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:26 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.954748, 21.613794)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(44.228810, 16.075696)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(46.106458, 10.188793)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:27 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(37.203204, 11.054418)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(28.534728, 14.896729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierPathCornerToEdge
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Corner to edge polygons
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [[NSBezierPath alloc] init];
	[b moveToPoint:NSMakePoint(100.0, 120.0)];
	[b lineToPoint:NSMakePoint(0.0, 120.0)];
	[b lineToPoint:NSMakePoint(50.0, 100.0)];
	[b closePath];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierCornerToCurve
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Curve to edge polygons
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [[NSBezierPath alloc] init];
	[b moveToPoint:NSMakePoint(100.0, 120.0)];
	[b lineToPoint:NSMakePoint(0.0, 120.0)];
	[b lineToPoint:NSMakePoint(50.0, 100.0)];
	[b closePath];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(104.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(104.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(65.829124, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(34.170876, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-4.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-4.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(34.170876, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(65.829124, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathCornerToCorner
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Corner to corner polygons
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(100.0, 100.0, 100.0, 100.0)];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 200.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 200.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathPartialEdgeToEdge
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Partial edge to edge polygons
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(100.0, 80.0, 100.0, 100.0)];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.0, 180.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 180.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathPartialEdgeToEdgeSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Partial edge to edge polygons
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(100.0, 80.0, 100.0, 100.0)];
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierPathFullEdgeToEdge
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Exactly coincident identical edges
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(100.0, 0.0, 100.0, 100.0)];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( [result elementCount] == 8, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathFullEdgeToEdgeSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Exactly coincident identical edges
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(100.0, 0.0, 100.0, 100.0)];
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( [result elementCount] == 6, @"Result had too many elements" );
}


- (void)testBezierPathOverlappingParallelEdges
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Overlapping parallel edges
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(50.0, 0.0, 100.0, 100.0)];
	
	// Union op
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(150.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(150.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathOverlappingParallelEdgesSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Overlapping parallel edges
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(50.0, 0.0, 100.0, 100.0)];
		
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Special case for subtraction that seems to be causing problems
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 50.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 150.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 150.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 150.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( [result elementCount] == 5, @"Result has too many elements" );
}

- (void)testBezierPathCornerThroughEdge
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Corner through edge
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [[NSBezierPath alloc] init];
	[b moveToPoint:NSMakePoint(150.0, 75.0)];
	[b lineToPoint:NSMakePoint(50.0, 75.0)];
	[b lineToPoint:NSMakePoint(100.0, 25.0)];
	[b closePath];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 25.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(150.0, 75.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 75.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(150.0, 75.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathCornerThroughEdgeSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Corner through edge
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [[NSBezierPath alloc] init];
	[b moveToPoint:NSMakePoint(150.0, 75.0)];
	[b lineToPoint:NSMakePoint(50.0, 75.0)];
	[b lineToPoint:NSMakePoint(100.0, 25.0)];
	[b closePath];
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 25.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 75.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 75.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathCornerThroughCorner
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Corner through corner
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [[NSBezierPath alloc] init];
	[b moveToPoint:NSMakePoint(50.0, 50.0)];
	[b lineToPoint:NSMakePoint(50.0, -50.0)];
	[b lineToPoint:NSMakePoint(150.0, -50.0)];
	[b closePath];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, -50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(150.0, -50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathCornerThroughCornerSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Corner through corner
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [[NSBezierPath alloc] init];
	[b moveToPoint:NSMakePoint(50.0, 50.0)];
	[b lineToPoint:NSMakePoint(50.0, -50.0)];
	[b lineToPoint:NSMakePoint(150.0, -50.0)];
	[b closePath];
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierPathCurveEndpointsCrossing
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(52.0, 52.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(62.0, 62.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 28, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.637749, 24.927071)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(100.505492, 38.573725)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(99.958567, 52.041433)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(113.426275, 51.494508)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(127.072929, 56.362251)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(137.355339, 66.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(156.881554, 86.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(156.881554, 117.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(137.355339, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(117.829124, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(86.170876, 156.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(66.644661, 137.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(56.362251, 127.072929)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(51.494508, 113.426275)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(52.041433, 99.958567)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(38.573725, 100.505492)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(24.927071, 95.637749)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-4.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-4.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(34.170876, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(65.829124, -4.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(78.707784, 92.002894)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(70.654111, 96.387339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(62.151726, 98.508672)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(61.161735, 109.875533)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(65.016402, 121.584945)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(73.715729, 130.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(89.336700, 145.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(114.663300, 145.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(130.284271, 130.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(145.905243, 114.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(145.905243, 89.336700)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(130.284271, 73.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(121.584945, 65.016402)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(109.875533, 61.161735)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(98.508672, 62.151726)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(96.387339, 70.654111)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(92.002894, 78.707784)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(78.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(62.663300, 6.094757)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(37.336700, 6.094757)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(6.094757, 37.336700)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(6.094757, 62.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.415055, 86.983598)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(42.124467, 90.838265)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(53.491328, 89.848274)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(55.612661, 81.345889)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(59.997106, 73.292216)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(66.644661, 66.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(73.292216, 59.997106)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(81.345889, 55.612661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(89.848274, 53.491328)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.838265, 42.124467)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(86.983598, 30.415055)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(78.284271, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:24 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(82.245143, 74.323399)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(85.201692, 69.738520)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(87.153917, 64.846083)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:25 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(82.261480, 66.798308)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(77.676601, 69.754857)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(73.715729, 73.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:26 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(69.754857, 77.676601)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(66.798308, 82.261480)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(64.846083, 87.153917)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:27 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(69.738520, 85.201692)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(74.323399, 82.245143)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierNestingOffsetRects
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 10.0, 10.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(20.0, 20.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierNestingOffsetRectsSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 10.0, 10.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(20.0, 20.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPartiallyNestingOffsetRects
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 5.0, 10.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(15.0, 20.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(105.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(105.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(5.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(5.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPartiallyNestingOffsetRectsSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 5.0, 10.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(15.0, 20.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFSubtractPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(5.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(5.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelOffsetrects
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 20.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(30.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(120.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(120.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 20.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 30.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 120.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 30.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 30.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelRectsWithCongruentSides
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 10.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(20.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 10.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 20.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 110.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelRectsWithCongruentSidesSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 80.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(90.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 14, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 80.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 90.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 14, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierParallelOffsetWithHoleSubtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 90.0, 50.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(100.0, 60.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFSubtractPath:b];
	
	XCTAssertTrue( [result elementCount] == 12, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon1
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 00.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 20.0, 30.0, 60.0)] bezierPathByReversingPath]];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 20.0, 30.0, 60.0)] bezierPathByReversingPath]];
	
	NSAffineTransform* tfm = [NSAffineTransform transform];
	[tfm translateXBy:-20 yBy:0];
	b = [tfm transformBezierPath:a];
	
	result = [a WFUnionWithPath:b];
	
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-20.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-20.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-10.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-10.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-10.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:24 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:25 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:26 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:27 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:28 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon1Subtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 00.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 20.0, 30.0, 60.0)] bezierPathByReversingPath]];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 20.0, 30.0, 60.0)] bezierPathByReversingPath]];
	
	NSAffineTransform* tfm = [NSAffineTransform transform];
	[tfm translateXBy:-20 yBy:0];
	b = [tfm transformBezierPath:a];
	
	result = [a WFSubtractPath:b];
	
	XCTAssertTrue( [result elementCount] == 20, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon2
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(50.0, 50.0, 300.0, 300.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(220.0, 220.0, 110.0, 110.0)] bezierPathByReversingPath]];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(70.0, 220.0, 110.0, 110.0)] bezierPathByReversingPath]];
	
	NSAffineTransform* tfm = [NSAffineTransform transform];
	[tfm translateXBy:260 yBy:0];
	b = [tfm transformBezierPath:a];
	
	result = [a WFUnionWithPath:b];

	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.0, 50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(350.0, 50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(610.0, 50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(610.0, 350.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(350.0, 350.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.0, 350.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 350.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.0, 50.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(220.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(220.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(220.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(180.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(180.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(480.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(480.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(590.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(590.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(480.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:24 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(440.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:25 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(440.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:26 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(350.0, 220.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:27 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(350.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:28 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(440.0, 330.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon2Subtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(50.0, 50.0, 300.0, 300.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(220.0, 220.0, 110.0, 110.0)] bezierPathByReversingPath]];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(70.0, 220.0, 110.0, 110.0)] bezierPathByReversingPath]];
	
	NSAffineTransform* tfm = [NSAffineTransform transform];
	[tfm translateXBy:260 yBy:0];
	b = [tfm transformBezierPath:a];
	
	result = [a WFSubtractPath:b];
	
	XCTAssertTrue( [result elementCount] == 19, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.000000, 50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.000000, 50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(220.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(220.000000, 330.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.000000, 330.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(310.000000, 350.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.000000, 350.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.000000, 50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.000000, 330.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(180.000000, 330.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(180.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(70.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(350.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(350.000000, 330.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(330.000000, 330.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(330.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(350.000000, 220.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon3
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 20.0, 20.0, 20.0)] bezierPathByReversingPath]];
	NSAffineTransform* tfm = [NSAffineTransform transform];
	[tfm translateXBy:40 yBy:-20];
	b = [tfm transformBezierPath:a];
	
	result = [a WFUnionWithPath:b];
	
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.0, -20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(140.0, -20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(140.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 80.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(120.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(120.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(120.0, 20.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierParallelComplexPolygon3Subtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 20.0, 20.0, 20.0)] bezierPathByReversingPath]];
	NSAffineTransform* tfm = [NSAffineTransform transform];
	[tfm translateXBy:40 yBy:-20];
	b = [tfm transformBezierPath:a];
	
	result = [a WFSubtractPath:b];
	
	XCTAssertTrue( [result elementCount] == 7, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon4Subtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 20.0, 20.0, 20.0)] bezierPathByReversingPath]];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 60.0, 20.0, 20.0)] bezierPathByReversingPath]];
	
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(20.0, 0.0, 100.0, 100.0)];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 20.0, 20.0, 20.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 60.0, 20.0, 20.0)] bezierPathByReversingPath]];
	
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 6, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 60.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon5Subtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 10.0, 30.0, 30.0)] bezierPathByReversingPath]];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 60.0, 30.0, 30.0)] bezierPathByReversingPath]];
	
	b = [NSBezierPath bezierPathWithRect:NSMakeRect(50.0, 30.0, 100.0, 100.0)];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 40.0, 30.0, 30.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(60.0, 90.0, 30.0, 30.0)] bezierPathByReversingPath]];
	
	result = [a WFSubtractPath:b];
	
	XCTAssertTrue( [result elementCount] == 22, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 40.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 40.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 60.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 60.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 40.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierParallelComplexPolygon6
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( -60.0, 70.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(-50.0, 80.0, 80.0, 80.0)] bezierPathByReversingPath]];
	
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[NSBezierPath bezierPathWithRect:NSMakeRect(40.0, 30.0, 20.0, 40.0)]];
	result = [a WFUnionWithPath:b];
	
	XCTAssertTrue( [result elementCount] == 34, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-60.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 170.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-60.000000, 170.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-60.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-50.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-50.000000, 160.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 160.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:20 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:21 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:22 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-50.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:23 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:24 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:25 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:26 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:27 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:28 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:29 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:30 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:31 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 70.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:32 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:33 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.000000, 30.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierParallelComplexPolygon7
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 20.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	
	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 14, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(4.477200, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.477200, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(110.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(115.522800, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(120.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(120.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(120.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(120.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(115.522800, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(110.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon7Subtract
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 20.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 10, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(4.477200, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.477200, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(30.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(24.477200, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(20.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(20.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(24.477200, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(30.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon8
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];

	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 9, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(4.477200, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.477200, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.522800, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(100.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(95.522800, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon8Subtract
{
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	result = [a WFSubtractPath:b];
	XCTAssertTrue([result elementCount] <= 1, @"Too many elements for an empty path");
}

- (void)testBezierParallelComplexPolygon8Intersect
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue( [result elementCount] == 9, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(4.477200, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.477200, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.522800, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(100.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(95.522800, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon9
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect( 280.0, 280.0, 300.0, 300.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(300.0, 300.0, 260.0, 260.0)] bezierPathByReversingPath]];
	
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 230.0, 280.0, 300.0, 300.0 )];
	
	result = [b WFUnionWithPath:a];
	XCTAssertTrue( [result elementCount] == 12, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(230.000000, 280.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(530.000000, 280.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(530.000000, 318.191102)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(532.061765, 320.038382)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(534.084710, 321.952675)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(536.066017, 323.933983)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(594.644661, 382.512627)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(594.644661, 477.487373)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(536.066017, 536.066017)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(534.084710, 538.047325)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(532.061765, 539.961618)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(530.000000, 541.808898)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(530.000000, 580.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(230.000000, 580.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(230.000000, 280.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(530.000000, 513.079506)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(570.000000, 465.046576)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(570.000000, 394.953424)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(530.000000, 346.920494)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(530.000000, 513.079506)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon10
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRoundedRect:NSMakeRect(10.0, 10.0, 80.0, 80.0) xRadius:10.0 yRadius:10.0] bezierPathByReversingPath]];
	
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 10.0, 10.0, 80.0, 80.0 ) xRadius:10.0 yRadius:10.0];
	
	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 10, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(4.477200, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.477200, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.522800, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(100.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(95.522800, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon10Subtract
{
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRoundedRect:NSMakeRect(10.0, 10.0, 80.0, 80.0) xRadius:10.0 yRadius:10.0] bezierPathByReversingPath]];
	
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 10.0, 10.0, 80.0, 80.0 ) xRadius:10.0 yRadius:10.0];
	
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 18, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(4.477200, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.477200, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(95.522800, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(100.000000, 4.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 95.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(95.522800, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(90.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.522800, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(90.000000, 85.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(90.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.000000, 14.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(85.522800, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(14.477200, 10.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(10.000000, 14.477200)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.000000, 85.522800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(14.477200, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(20.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 90.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelComplexPolygon10Intersect
{
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 ) xRadius:10.0 yRadius:10.0];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRoundedRect:NSMakeRect(10.0, 10.0, 80.0, 80.0) xRadius:10.0 yRadius:10.0] bezierPathByReversingPath]];
	
	b = [NSBezierPath bezierPathWithRoundedRect:NSMakeRect( 10.0, 10.0, 80.0, 80.0 ) xRadius:10.0 yRadius:10.0];
	
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue([result elementCount] < 2, @"Too many elements for an empty path");
}

- (void)testBezierOverlappingAngleOffsetSpheres
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-50.0, -50.0, 100.0, 100.0)];
	NSAffineTransform * t = [[NSAffineTransform alloc] init];
	
	[t rotateByDegrees:45.0];
	b = [t transformBezierPath:a];
	
	result = [a WFUnionWithPath:b];
	XCTAssertTrue( [result elementCount] == 9, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(35.355339, 35.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(25.592232, 45.118446)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(12.796117, 49.999999)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.000002, 50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-12.796115, 50.000001)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-25.592231, 45.118447)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-35.355339, 35.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-45.118446, 25.592232)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-50.000000, 12.796116)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-50.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-50.000000, -12.796116)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-45.118446, -25.592232)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-35.355339, -35.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-25.592232, -45.118446)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-12.796116, -50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-0.000000, -50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(12.796116, -50.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(25.592232, -45.118446)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(35.355339, -35.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(45.118446, -25.592232)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(50.000000, -12.796116)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(50.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(50.000000, 12.796116)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(45.118446, 25.592232)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(35.355339, 35.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierIntersectingSpheres
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(60.0, 0.0, 100.0, 100.0)];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(70.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	
	result = [a WFUnionWithPath:b];
	
	XCTAssertTrue( [result elementCount] == 20, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-4.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-4.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(32.472249, -3.182927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(60.412899, -4.733786)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 9.992082)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(99.587101, -4.733786)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(127.527751, -3.182927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(145.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(164.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(164.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(145.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(127.527751, 103.182927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(99.587101, 104.733786)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 90.007918)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.412899, 104.733786)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(32.472249, 103.182927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(21.715729, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(6.094757, 37.336700)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(6.094757, 62.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(35.529629, 92.098172)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(56.933502, 93.696197)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(72.503454, 83.078346)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(55.832182, 64.216466)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(55.832182, 35.783534)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(72.503454, 16.921654)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(56.933502, 6.303803)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(35.529629, 7.901828)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(138.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(124.470371, 7.901828)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(103.066498, 6.303803)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(87.496546, 16.921654)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(104.167818, 35.783534)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(104.167818, 64.216466)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(87.496546, 83.078346)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(103.066498, 93.696197)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(124.470371, 92.098172)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(138.284271, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(153.905243, 62.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(153.905243, 37.336700)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(138.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 23.540450)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(66.666667, 38.628927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(66.666667, 61.371073)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 76.459550)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:19 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(93.333333, 61.371073)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(93.333333, 38.628927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 23.540450)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierParallelRectsWithOverlappingCongruentSides
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 5.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(15.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(5.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(105.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(105.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(5.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 10.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(15.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	a = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 5.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 15.0, 80.0, 80.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[b appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFUnionWithPath:b];
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 105.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 105.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 5.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 0.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 5.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 100.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.0, 105.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(90.0, 15.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 15.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.0, 90.0)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathBasicSubtraction
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Single path intersections along all corners of original path
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(56.0, 52.0, 100.0, 100.0)];
	result = [a WFSubtractPath:b];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-56.0, -52.0, 100.0, 100.0)];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 7, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 47.640857)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.729500, 46.351375)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(21.121143, 41.589535)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(29.355339, 33.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(38.609688, 24.100990)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(43.477986, 12.121499)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(43.960233, -0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Dual path intersect
	[a appendBezierPath:[NSBezierPath bezierPathWithRect:NSMakeRect(200.0, 100.0, 100.0, 200.0)]];
	[b appendBezierPath:[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(250.0, 250.0, 100.0, 100.0)]];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 15, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 47.640857)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.729500, 46.351375)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(21.121143, 41.589535)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(29.355339, 33.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(38.609688, 24.100990)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(43.477986, 12.121499)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(43.960233, -0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(287.203884, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(274.407768, 254.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(264.644661, 264.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(254.881554, 274.407768)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(250.000000, 287.203884)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(250.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Tripple intersect
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(52.0, 62.0, 200.0, 100.0)];
	[a appendBezierPath:[NSBezierPath bezierPathWithRect:NSMakeRect(200.0, 100.0, 100.0, 200.0)]];
	[b appendBezierPath:[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(250.0, 250.0, 100.0, 100.0)]];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 16, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 69.278146)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(93.338956, 71.308748)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(87.050138, 73.764253)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(81.289322, 76.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(67.915151, 83.331746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(59.121194, 91.441721)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(54.907449, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(287.203884, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(274.407768, 254.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(264.644661, 264.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(254.881554, 274.407768)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(250.000000, 287.203884)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(250.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 155.878269)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(208.149489, 153.647153)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(215.809003, 150.806177)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(222.710678, 147.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(248.388937, 134.516210)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(257.182895, 116.431800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(249.092551, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Single Paths with holes
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(20.0, 20.0, 60.0, 60.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(32.0, 32.0, 100.0, 100.0)];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(52.0, 52.0, 60.0, 60.0)] bezierPathByReversingPath]];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 19, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 35.338988)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(93.589359, 32.870067)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(86.772515, 31.770327)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 32.039767)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(32.039767, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(31.770327, 86.772515)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(32.870067, 93.589359)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(35.338988, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(57.995249, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(53.578013, 94.124567)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(51.601707, 86.996400)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(52.066330, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 52.066330)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(86.996400, 51.601707)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(94.124567, 53.578013)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 57.995249)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:18 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(20.000000, 20.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Both paths curved
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(56.0, 52.0, 100.0, 100.0)];
	result = [a WFSubtractPath:b];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-32.0, -32.0, 100.0, 100.0)];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 7, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(104.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(104.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(65.829124, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(34.170876, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(8.886035, 79.596714)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.825730, 72.782887)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(2.463746, 65.536254)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(19.788828, 71.183233)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(39.587750, 67.122928)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(53.355339, 53.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(67.122928, 39.587750)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(71.183233, 19.788828)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(65.536254, 2.463746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(72.782887, 4.825730)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(79.596714, 8.886035)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-22.0, -22.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFSubtractPath:b];
	XCTAssertTrue( [result elementCount] == 18, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(104.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(104.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(65.829124, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(34.170876, 104.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(8.886035, 79.596714)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(4.825730, 72.782887)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(2.463746, 65.536254)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(6.284091, 66.781467)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(10.224725, 67.554668)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.194455, 67.855858)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(16.071533, 71.618621)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(18.578624, 75.147166)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(37.336700, 93.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(62.663300, 93.905243)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 78.284271)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(93.905243, 62.663300)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(93.905243, 37.336700)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(78.284271, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(75.147166, 18.578624)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(71.618621, 16.071533)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(67.855858, 14.194455)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(67.554668, 10.224725)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(66.781467, 6.284091)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(65.536254, 2.463746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(72.782887, 4.825730)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(79.596714, 8.886035)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(85.355339, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(25.376366, 3.912956)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(39.772741, -0.920550)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(53.805545, 0.144142)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(55.481778, 3.504296)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(56.655606, 7.051227)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(57.327028, 10.672972)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(44.809439, 8.352384)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(31.398155, 12.033303)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(21.715729, 21.715729)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(12.033303, 31.398155)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(8.352384, 44.809439)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.672972, 57.327028)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:16 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(7.051227, 56.655606)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(3.504296, 55.481778)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.144142, 53.805545)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:17 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-0.920550, 39.772741)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(3.912956, 25.376366)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testBezierPathBasicIntersection
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	// Single path intersections along all corners of original path
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(56.0, 52.0, 100.0, 100.0)];
	result = [a WFIntersectWithPath:b];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-56.0, -52.0, 100.0, 100.0)];
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue( [result elementCount] == 6, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(43.960233, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(43.477986, 12.121499)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(38.609688, 24.100990)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(29.355339, 33.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(21.121143, 41.589535)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(10.729500, 46.351375)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-0.000000, 47.640857)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Dual path intersect
	[a appendBezierPath:[NSBezierPath bezierPathWithRect:NSMakeRect(200.0, 100.0, 100.0, 200.0)]];
	[b appendBezierPath:[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(250.0, 250.0, 100.0, 100.0)]];
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue( [result elementCount] == 10, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(43.960233, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(43.477986, 12.121499)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(38.609688, 24.100990)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(29.355339, 33.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(21.121143, 41.589535)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(10.729500, 46.351375)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(-0.000000, 47.640857)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(0.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(250.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(250.000000, 287.203884)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(254.881554, 274.407768)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(264.644661, 264.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(274.407768, 254.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(287.203884, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(300.000000, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Tripple intersect
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(52.0, 62.0, 200.0, 100.0)];
	[a appendBezierPath:[NSBezierPath bezierPathWithRect:NSMakeRect(200.0, 100.0, 100.0, 200.0)]];
	[b appendBezierPath:[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(250.0, 250.0, 100.0, 100.0)]];
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue( [result elementCount] == 16, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(54.907449, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(59.121194, 91.441721)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(67.915151, 83.331746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(81.289322, 76.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(87.050138, 73.764253)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(93.338956, 71.308748)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 69.278146)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(249.092551, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(257.182895, 116.431800)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(248.388937, 134.516210)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(222.710678, 147.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(215.809003, 150.806177)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(208.149489, 153.647153)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(200.000000, 155.878269)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(250.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(250.000000, 287.203884)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(254.881554, 274.407768)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(264.644661, 264.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(274.407768, 254.881554)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(287.203884, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(300.000000, 250.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(300.000000, 300.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:15 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(200.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Single Paths with holes
	a = [NSBezierPath bezierPathWithRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	[a appendBezierPath:[[NSBezierPath bezierPathWithRect:NSMakeRect(20.0, 20.0, 60.0, 60.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(32.0, 32.0, 100.0, 100.0)];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(52.0, 52.0, 60.0, 60.0)] bezierPathByReversingPath]];
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue( [result elementCount] == 10, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 35.338988)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(100.000000, 57.995249)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(94.124567, 53.578013)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(86.996400, 51.601707)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 52.066330)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 32.039767)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(86.772515, 31.770327)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(93.589359, 32.870067)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(100.000000, 35.338988)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(35.338988, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(32.870067, 93.589359)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(31.770327, 86.772515)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(32.039767, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(52.066330, 80.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(51.601707, 86.996400)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(53.578013, 94.124567)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(57.995249, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(35.338988, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	// Both paths curved
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(0.0, 0.0, 100.0, 100.0)];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(56.0, 52.0, 100.0, 100.0)];
	result = [a WFIntersectWithPath:b];
	b = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-32.0, -32.0, 100.0, 100.0)];
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue( [result elementCount] == 5, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(28.412250, 0.877072)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(48.211172, -3.183233)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(65.536254, 2.463746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(71.183233, 19.788828)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(67.122928, 39.587750)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(53.355339, 53.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(39.587750, 67.122928)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(19.788828, 71.183233)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(2.463746, 65.536254)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-3.183233, 48.211172)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.877072, 28.412250)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(10.0, 10.0, 80.0, 80.0)] bezierPathByReversingPath]];
	[b appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(-22.0, -22.0, 80.0, 80.0)] bezierPathByReversingPath]];
	result = [a WFIntersectWithPath:b];
	XCTAssertTrue( [result elementCount] == 10, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(2.463746, 65.536254)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(1.218533, 61.715909)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(0.445332, 57.775275)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(0.144142, 53.805545)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(3.504296, 55.481778)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(7.051227, 56.655606)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(10.672972, 57.327028)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(11.344394, 60.948773)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(12.518222, 64.495704)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.194455, 67.855858)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(10.224725, 67.554668)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(6.284091, 66.781467)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(2.463746, 65.536254)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(65.536254, 2.463746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(66.781467, 6.284091)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(67.554668, 10.224725)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(67.855858, 14.194455)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(64.495704, 12.518222)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(60.948773, 11.344394)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(57.327028, 10.672972)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(56.655606, 7.051227)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(55.481778, 3.504296)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(53.805545, 0.144142)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(57.775275, 0.445332)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(61.715909, 1.218533)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(65.536254, 2.463746)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}


- (void)testBezierCurveSinglePointTouch1
{
	NSBezierPathElement element;
	CGPoint points[3];
	NSBezierPath * a;
	NSBezierPath * b;
	NSBezierPath * result;
	
	a = [NSBezierPath bezierPathWithOvalInRect:NSMakeRect( 0.0, 0.0, 100.0, 100.0 )];
	[a appendBezierPath:[[NSBezierPath bezierPathWithOvalInRect:NSMakeRect(20.0, 20.0, 60.0, 60.0)] bezierPathByReversingPath]];
	b = [NSBezierPath bezierPathWithRect:NSMakeRect( 80.0, 0.0, 100.0, 100.0 )];
	result = [a WFUnionWithPath:b];
	
	XCTAssertTrue( [result elementCount] == 15, @"Incorrect element count" );
	element = [result elementAtIndex:0 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:1 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(-4.881554, 65.829124)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(-4.881554, 34.170876)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 14.644661)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:2 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(32.472249, -3.182927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(60.412899, -4.733786)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(80.000000, 9.992082)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:3 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:4 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(180.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:5 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(180.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:6 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 100.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:7 associatedPoints:points];
	XCTAssertTrue( element == NSLineToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 90.007918)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:8 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(60.412899, 104.733786)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(32.472249, 103.182927)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(14.644661, 85.355339)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:9 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(71.213203, 28.786797)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:10 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(59.497475, 17.071068)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(40.502525, 17.071068)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(28.786797, 28.786797)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:11 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(17.071068, 40.502525)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(17.071068, 59.497475)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(28.786797, 71.213203)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:12 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(40.502525, 82.928932)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(59.497475, 82.928932)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(71.213203, 71.213203)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:13 associatedPoints:points];
	XCTAssertTrue( element == NSCurveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(82.928932, 59.497475)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[1], CGPointMake(82.928932, 40.502525)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	XCTAssertTrue( WFGeometryDistance(points[2], CGPointMake(71.213203, 28.786797)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
	element = [result elementAtIndex:14 associatedPoints:points];
	XCTAssertTrue( element == NSMoveToBezierPathElement, @"Incorrect element" );
	XCTAssertTrue( WFGeometryDistance(points[0], CGPointMake(80.000000, 0.000000)) <= WFBezierPointAcceptanceResolution, @"Incorrect result point" );
}

- (void)testCurveZeroFinding
{
	CGPoint curve[4];
	CGFloat result[3];
	
	curve[0] = CGPointMake(120, -160);
	curve[1] = CGPointMake(120, 320);
	curve[2] = CGPointMake(220, -320);
	curve[3] = CGPointMake(220,  160);
	
	uint64_t count = WFGeometryFindRootsOfCubicCurve( curve, result, false );
	XCTAssert( count == 3, @"Not enough roots found" );
	XCTAssertEqualWithAccuracy( result[0], 0.1726731646460114, WFGeometryParametricResolution, @"Did not find correct root");
	XCTAssertEqualWithAccuracy( result[1], 0.8273268353539885, WFGeometryParametricResolution, @"Did not find correct root");
	XCTAssertEqualWithAccuracy( result[2], 0.4999999999999999, WFGeometryParametricResolution, @"Did not find correct root");
}

@end
